<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Fantasy Fotball</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="assets/css/sb-admin-2.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>


    <style>
        #player-list {
            max-height: 400px; /* Adjust the height as needed */
            overflow-y: auto;  /* Adds vertical scrollbar */
            overflow-x: hidden; /* Prevents horizontal scrolling */
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .player-card {
            flex: 0 0 30%; /* Adjust the width of each card to fit within the div */
            box-sizing: border-box;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            text-align: center;
            margin-bottom: 10px;
        }

        .player-card.selected {
            border-color: green;
            background-color: #f0f8ff;
        }
        .league-cards {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .league-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #f8f9fc;
            border-radius: 5px;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .league-item h6 {
            margin: 0;
            font-weight: bold;
            color: #4e73df;
        }

        .join-btn {
            background-color: #1cc88a;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .join-btn:hover {
            background-color: #17a673;
        }

        .card-body {
            max-height: 400px;   /* Add a max height to avoid overflowing */
            overflow-y: auto;    /* Enable vertical scrolling if content exceeds the max height */
        }

        .list-group {
            padding-left: 0;     /* Proper list styling */
        }

        .list-group-item {
            margin-bottom: 5px;  /* Add some spacing between members */
        }
        

    </style>
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-laugh-wink"></i>
                </div>
                <div class="sidebar-brand-text mx-3">Fantasy football</div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Nav Item - Dashboard -->
            <li class="nav-item active">
                <a class="nav-link" href="index.html">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Dashboard</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">


            <!-- Heading -->
            <div class="sidebar-heading">
                Addons
            </div>

            <!-- Nav Item - Pages Collapse Menu -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapsePages"
                    aria-expanded="true" aria-controls="collapsePages">
                    <i class="fas fa-fw fa-folder"></i>
                    <span>Pages</span>
                </a>
                <div id="collapsePages" class="collapse" aria-labelledby="headingPages" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">Login Screens:</h6>
                        <a class="collapse-item" href="login.html">Login</a>
                        <a class="collapse-item" href="register.html">Register</a>
                        <a class="collapse-item" href="players.html">Player detail</a>
                        <div class="collapse-divider"></div>
                    </div>
                </div>
            </li>

            <!-- Nav Item - Charts -->
            <li class="nav-item">
                <a class="nav-link" href="https://sportsport.ba/fudbal/bosna-i-hercegovina/wwin-liga-bih" target="_blank">
                    <i class="fas fa-fw fa-chart-area"></i>
                    <span>News</span></a>
            </li>


            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>

        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <!-- Topbar Search -->
                    <form
                        class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                        <div class="input-group">
                            <input type="text" class="form-control bg-light border-0 small" placeholder="Search for..."
                                aria-label="Search" aria-describedby="basic-addon2">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="button">
                                    <i class="fas fa-search fa-sm"></i>
                                </button>
                            </div>
                        </div>
                    </form>

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">

                        <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                        <li class="nav-item dropdown no-arrow d-sm-none">
                            <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-search fa-fw"></i>
                            </a>
                            <!-- Dropdown - Messages -->
                            <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                                aria-labelledby="searchDropdown">
                                <form class="form-inline mr-auto w-100 navbar-search">
                                    <div class="input-group">
                                        <input type="text" class="form-control bg-light border-0 small"
                                            placeholder="Search for..." aria-label="Search"
                                            aria-describedby="basic-addon2">
                                        <div class="input-group-append">
                                            <button class="btn btn-primary" type="button">
                                                <i class="fas fa-search fa-sm"></i>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </li>

                        <div class="topbar-divider d-none d-sm-block"></div>

                        <!-- Nav Item - User Information -->
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small">USER</span>
                            </a>
                            <!-- Dropdown - User Information -->
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="userDropdown">
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Profile
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Settings
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Activity Log
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Logout
                                </a>
                            </div>
                        </li>
                    </ul>

                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
                    </div>

                    <!-- Content Row -->
                    <div class="row">

                        <!-- TOtal points -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Total Points</h6>
                                </div>
                                <div class="card-body">
                                    <h3 id="total-points" class="text-center">0</h3> <!-- This will display the total points -->
                                </div>
                            </div>
                        </div>

                        <!-- Create league -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card shadow mb-4" style="height: auto;">
                                <div class="card-body" style="padding: 15px;">
                                    <form id="create-league-form" class="league-item">
                                        <div class="form-group">
                                            <label for="league-name" class="font-weight-bold text-primary">League Name</label>
                                            <input type="text" class="form-control league-input" id="league-name" name="league_name" required placeholder="Enter League Name">
                                        </div>
                                        <button type="submit" class="btn join-btn">Create League</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Tasks
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                    <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">50%</div>
                                                </div>
                                                <div class="col">
                                                    <div class="progress progress-sm mr-2">
                                                        <div class="progress-bar bg-info" role="progressbar"
                                                            style="width: 50%" aria-valuenow="50" aria-valuemin="0"
                                                            aria-valuemax="100"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pending Requests Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                Pending Requests</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">18</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-comments fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>




                    <!-- Content Row -->

                    <div class="row">
                        <!-- Selection and viewing players -->
                        <div class="col-xl-8 col-lg-7">
                            <div class="card shadow mb-4" style="height: auto;">
                                <!-- Card Header - Dropdown -->
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Select Your Squad</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="input-group mb-3" style="max-width: 50%;">
                                    <input type="text" id="player-search-input" class="form-control" placeholder="Search by Name, Position, Age, Nation">
                                    <div class="input-group-append">
                                        <button class="btn btn-primary" id="player-search-btn" type="button">
                                            <i class="fas fa-search"></i> Search
                                        </button>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div id="player-list" class="chart-area player-list">
                                        <!-- Players will be loaded here -->
                                    </div>
                                    <button id="save-squad" class="btn btn-primary mt-3" disabled>Save Squad</button>
                                </div>
                            </div>
                        </div>
                    
                        <!-- League List Section -->
                        <div class="col-xl-4 col-lg-5">
                            <div class="card shadow mb-4" style="height: auto;">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Available Leagues</h6>
                                </div>
                                <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                                    <div id="leagues-list" class="league-cards">
                                        <!-- Leagues will be dynamically loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>




                    <!-- Content Row -->
                    <div class="row">

                        <!-- Content Column -->
                        <div class="col-lg-6 mb-4">

                            <!-- Project Card Example -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">User Leagues</h6>
                                </div>
                                <div class="card-body" id="user-leagues-container">
                                    <!-- League and members info will be injected here by JS -->
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6 mb-4">

                            <!-- Illustrations -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Rules and Scoring</h6>
                                </div>
                                <div class="card-body">
                                    <div class="text-center">
                                    </div>
                                    <p>In fantasy football app, scoring points is based on the real-life performance of players in their 
                                        respective matches. </p><p>Each player in a user's fantasy team earns points for various in-game actions, 
                                        such as scoring goals, providing assists, or keeping clean sheets for defenders and goalkeepers. 
                                        Offensive players, like forwards and midfielders, typically gain points for goals, assists, and 
                                        shots on target. Defenders and goalkeepers earn points for preventing goals, maintaining clean 
                                        sheets, and making saves. Negative points can also be awarded for actions like receiving yellow 
                                        or red cards, missing penalties, or conceding goals. The scoring system varies by league and app, 
                                        but the objective is for users to strategically assemble a team that accumulates the highest points 
                                        based on player performances each week.</p>
                                </div>
                            </div>

                            <!-- Approach -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Development Approach</h6>
                                </div>
                                <div class="card-body">
                                    <p>Fantasy football is an online game where users create virtual teams made up of real-life football 
                                        players, earning points based on their performance in actual matches. The app is built using 
                                        modern web technologies like Bootstrap for responsive design, with custom components and utility 
                                        classes ensuring optimal user experience and streamlined performance.</p>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Fantasy football 2024</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>  
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="assets/js/sb-admin-2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="assets/js/user-service.js"></script>
    <script src="assets/js/squad.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="assets/js/demo/chart-area-demo.js"></script>
    <script src="assets/js/demo/chart-pie-demo.js"></script>
    <script>

document.addEventListener("DOMContentLoaded", function() {
    var token = localStorage.getItem('user_token');
    var isAdmin = localStorage.getItem('is_admin');  // Get is_admin from localStorage
    
    if (!token || isAdmin == 1) {
        // If there's no token or if admin tries to access user page, redirect to login
        console.log("No token or admin trying to access user page, redirecting to login.");
        window.location.replace('login.html');
    } else {
        console.log("User token and privileges found:", token);  // Log token for debugging
    }
});

$(document).ready(function () {
    $('#create-league-form').submit(function (e) {
        e.preventDefault(); // Prevent normal form submission

        const leagueName = $('#league-name').val(); // Get the league name from the form
        const token = localStorage.getItem("user_token");  // Assume you're storing the token in localStorage

        if (!leagueName) {
            alert("Please enter a league name.");
            return;
        }

        // AJAX call to create the league
        $.ajax({
            type: 'POST',
            url: 'rest/leagues/create',  // Backend API endpoint for league creation
            contentType: 'application/json',
            data: JSON.stringify({ league_name: leagueName }),  // Send the league name as JSON
            headers: {
                'Authorization': 'Bearer ' + token  // Include authorization token
            },
            success: function (response) {
                toastr.success("League created successfully!");
                console.log("Success response:", response);
            },
            error: function (xhr, status, error) {
                console.log("Error status:", status);
                console.log("Error details:", error);
                console.log("XHR response:", xhr.responseText);
                toastr.error("Error creating league.");
            }
        });
    });


    // Fetch all leagues on page load
    function fetchLeagues() {
        $.ajax({
            type: 'GET',
            url: 'rest/leagues',  // API endpoint to fetch all leagues
            contentType: 'application/json',
            success: function (leagues) {
                // Empty the container before appending new leagues
                $('#leagues-list').empty();

                // Loop through each league and append it to the leagues-list container
                leagues.forEach(function (league) {
                    var leagueItem = `
                        <div class="league-item" style="margin-bottom: 15px;">
                            <span>${league.league_name}</span>
                            <button class="btn btn-primary join-btn" data-league-id="${league.league_id}">Join</button>
                        </div>
                    `;
                    $('#leagues-list').append(leagueItem);
                });

                // Attach click event to "Join" buttons
                $('.join-btn').on('click', function () {
                    var leagueId = $(this).data('league-id');
                    
                    // Call the joinLeague function when the "Join" button is clicked
                    joinLeague(leagueId);
                });
            },
            error: function (xhr, status, error) {
                toastr.error("Error fetching leagues: " + error);  // Show error message using toastr
            }
        });
    }

    // Function to join a league when the "Join" button is clicked
    function joinLeague(leagueId) {
        var token = localStorage.getItem('user_token');  // Assuming you're storing the token in localStorage

        $.ajax({
            type: 'POST',
            url: 'rest/league_members/join',  // API endpoint to join the league
            contentType: 'application/json',
            headers: {
                'Authorization': 'Bearer ' + token  // Include authorization token
            },
            data: JSON.stringify({ league_id: leagueId }),  // Send the league ID in the request
            success: function (response) {
                if (response.status === 'error') {
                    toastr.error(response.message);  // If there's an error, show it
                } else {
                    toastr.success("Successfully joined the league!");  // On success, show this message
                }
            },
            error: function (xhr, status, error) {
                  // Show error message using toastr
            }
        });
    }

    // Call the fetchLeagues function on page load
    fetchLeagues();
});

$(document).ready(function () {
    // Function to fetch leagues the user has joined and their points
    function fetchUserLeaguesWithPoints() {
        // Get the JWT token from localStorage or sessionStorage
        var token = localStorage.getItem('user_token'); // Assuming you store the token in localStorage

        $.ajax({
            type: 'GET',
            url: 'rest/user/leagues',  // API endpoint to get user leagues with total points
            contentType: 'application/json',
            headers: {
                'Authorization': 'Bearer ' + token  // Include the Bearer token in the request headers
            },
            success: function (leagues) {
                // Empty the specific target div before appending new content
                var leaguesContainer = $('#user-leagues-container'); // Target the specific div
                leaguesContainer.empty(); // Clear previous data

                // Check if there are leagues
                if (Object.keys(leagues).length === 0) {
                    leaguesContainer.append('<p>No leagues joined yet.</p>');
                    return;
                }

                // Loop through each league and its members, and append to the div
                $.each(leagues, function (leagueName, members) {
                    var leagueHtml = `
                        <h4 class="small font-weight-bold">${leagueName} <span class="float-right">Members: ${members.length}</span></h4>
                        <ul class="list-group mb-4">
                    `;

                    // Append all members of the league and their total points
                    members.forEach(function (member) {
                        leagueHtml += `<li class="list-group-item">${member.username} - Total Points: ${member.total_points}</li>`;
                    });

                    leagueHtml += `</ul>`;
                    leaguesContainer.append(leagueHtml);
                });
            },
            error: function (xhr, status, error) {
                toastr.error("Error fetching user leagues: " + error);  // Show error message using toastr
            }
        });
    }

    // Fetch the user's leagues and points on page load
    fetchUserLeaguesWithPoints();
});

$(document).ready(function() {
    // Fetch and display players
    $.get('rest/players', function(data) {
        populatePlayersTable(data);

        // Attach the search event
        $('#player-search-btn').on('click', function() {
    console.log("Search button clicked!"); // To check if the button click is detected

    var searchQuery = $('#player-search-input').val().toLowerCase();
    console.log("Search query:", searchQuery); // Log the search query

    var filteredPlayers = data.filter(function(player) {
        // Filter by name, position, age, or nation
        return (
            player.name.toLowerCase().includes(searchQuery) || 
            player.position.toLowerCase().includes(searchQuery) ||
            player.age.toString().includes(searchQuery) || 
            player.nation.toLowerCase().includes(searchQuery)
        );
    });

    console.log("Filtered players:", filteredPlayers); // Log the filtered players
    populatePlayersTable(filteredPlayers);  // Update table with filtered data
});
    });

    function populatePlayersTable(players) {
    console.log("Populating table with players:", players); // Log the players to be displayed

    var tableBody = '';
    for (var i = 0; i < players.length; i++) {
        tableBody += '<tr>' +
                        '<td>' + players[i].name + '</td>' +
                        '<td>' + players[i].surname + '</td>' +
                        '<td>' + players[i].position + '</td>' +
                        '<td>' + players[i].nation + '</td>' +
                        '<td>' + players[i].points_per_game + '</td>' +
                        '<td>' + players[i].team + '</td>' +
                        '<td><button class="btn btn-danger delete-player" data-id="' + players[i].ID + '">Delete</button></td>' +
                        '<td><button class="btn btn-primary edit-player" data-id="' + players[i].ID + '">Edit</button></td>' +
                    '</tr>';
    }
    $("#players-table tbody").html(tableBody);  // Update the table body

    console.log("Table updated!"); // Log when the table is updated
}
});
    </script>

</body>

</html>